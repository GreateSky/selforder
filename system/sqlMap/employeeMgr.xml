<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.selforder.employee" >
	<cache eviction="LRU" flushInterval="1000" size="1024" readOnly="false" />
	<sql id="limit">
		<choose>
			<when test="pageStart != null and pageSize != null">
				limit ${pageStart},${pageSize}
			</when>
			<otherwise>
				limit 0,20
			</otherwise>
		</choose>
	</sql>
	<!--新增员工信息 -->
	<insert id="insertEmployee">
	    INSERT
			INTO
			    self_employee
			    (
			        EMPID,
			        EMPCODE,
			        LOGINNAME,
			        PASSWORD,
			        EMPNAME,
			        SEX,
			        STATUS,
			        TYPE,
			        PHONE,
			        HOMEADDRESS,
			        WECHATID,
			        OPENID,
			        HEADIMGURL,
			        CONTACTNAME,
			        CONTACTPHONE,
			        LOGINNUM,
			        LASTLOGINDATE,
			        SID,
			        BID,
			        CRTER,
			        CRTDATE
			    )
			    VALUES
			    (
			        replace(uuid(),'-',''),
					#{empcode},
					#{loginname},
					#{password},
					#{empname},
					#{sex},
					#{status},
					#{type},
					#{phone},
					#{homeaddress},
					#{wechatid},
					#{openid},
					#{headimgurl},
					#{contactname},
					#{contactphone},
					0,
					#{lastlogindate},
					#{sid},
					#{bid},
					#{crter},
					sysdate()
			    )
	</insert>
	
	<!--获取员工列表 -->
	<select id="getEmployeeList"  parameterType="employee" resultType="employee">
		SELECT
		        emp.EMPID,
		        emp.EMPCODE,
		        emp.LOGINNAME,
		        emp.PASSWORD,
		        emp.EMPNAME,
		        emp.SEX,
		        emp.STATUS,
		        emp.TYPE,
		        emp.PHONE,
		        emp.HOMEADDRESS,
		        emp.WECHATID,
		        emp.OPENID,
		        emp.HEADIMGURL,
		        emp.CONTACTNAME,
		        emp.CONTACTPHONE,
		        emp.LOGINNUM,
		        emp.LASTLOGINDATE,
		        emp.SID,
		        emp.BID,
		        business.BNAME,
		        bs.SNAME,
		        emp.CRTER,
		        emp.CRTDATE,
		        emp.OPTER,
		        emp.OPTDATE,
		        emp.DELETED
		FROM
		    self_employee emp
		left join SELF_BUSINESS business on business.BID = emp.BID
		left join SELF_BUSINESS_SHOP bs on bs.SID = emp.SID    
		where emp.DELETED = 0 
		<if test="bid != null and bid !='' ">
			and emp.BID =#{bid}
		</if>  
		<if test="sid != null and sid !='' ">
			and emp.SID =#{sid}
		</if> 
		<if test="empname != null and empname !='' ">
			and emp.EMPNAME like CONCAT('%',#{empname},'%')
		</if>
		<if test="phone != null and phone !='' ">
			and emp.PHONE like CONCAT('%',#{phone},'%')
		</if>
		<if test="empcode != null and empcode !='' ">
			and emp.EMPCODE = #{empcode}
		</if>
		order by emp.OPTDATE desc,CRTDATE desc
		<include refid="limit"></include>
		
	</select>
	<!--查询员工列表统计数  用于列表分页 -->
	<select id="getEmployeeCount" parameterType="employee" resultType="int">
		SELECT
		       count(1)
		FROM
		    self_employee emp
		left join SELF_BUSINESS business on business.BID = emp.BID
		left join SELF_BUSINESS_SHOP bs on bs.SID = emp.SID    
		where emp.DELETED = 0 
		<if test="bid != null and bid !='' ">
			and emp.BID =#{bid}
		</if>  
		<if test="sid != null and sid !='' ">
			and emp.SID =#{sid}
		</if> 
		<if test="empname != null and empname !='' ">
			and emp.EMPNAME like CONCAT('%',#{empname},'%')
		</if>
		<if test="phone != null and phone !='' ">
			and emp.PHONE like CONCAT('%',#{phone},'%')
		</if>
		<if test="empcode != null and empcode !='' ">
			and emp.EMPCODE = #{empcode}
		</if>
	</select>
	
	<!--获取员工详情 -->
	<select id="getEmployeeInfo"  parameterType="employee" resultType="employee">
		SELECT
		        emp.EMPID,
		        emp.EMPCODE,
		        emp.LOGINNAME,
		        emp.PASSWORD,
		        emp.EMPNAME,
		        emp.SEX,
		        emp.STATUS,
		        emp.TYPE,
		        emp.PHONE,
		        emp.HOMEADDRESS,
		        emp.WECHATID,
		        emp.OPENID,
		        emp.HEADIMGURL,
		        emp.CONTACTNAME,
		        emp.CONTACTPHONE,
		        emp.LOGINNUM,
		        emp.LASTLOGINDATE,
		        emp.SID,
		        emp.BID,
		        business.BNAME,
		        bs.SNAME,
		        emp.CRTER,
		        emp.CRTDATE,
		        emp.OPTER,
		        emp.OPTDATE,
		        emp.DELETED
		FROM
		    self_employee emp
		left join SELF_BUSINESS business on business.BID = emp.BID
		left join SELF_BUSINESS_SHOP bs on bs.SID = emp.SID    
		where emp.DELETED = 0 
		<if test="bid != null and bid !='' ">
			and emp.BID =#{bid}
		</if>  
		<if test="sid != null and sid !='' ">
			and emp.SID =#{sid}
		</if> 
		<if test="sid != null and sid !='' ">
			and emp.SID =#{sid}
		</if>
		<if test="empname != null and empname !='' ">
			and emp.EMPNAME like CONCAT('%',#{empname},'%')
		</if>
		<if test="phone != null and phone !='' ">
			and emp.PHONE like CONCAT('%',#{phone},'%')
		</if>
		<if test="empcode != null and empcode !='' ">
			and emp.EMPCODE like CONCAT('%',#{empcode},'%')
		</if>
		<if test="loginname != null and loginname !='' ">
			and emp.LOGINNAME = #{loginname}
		</if>
		<if test="empid != null and empid !='' ">
			and emp.EMPID = #{empid}
		</if>
		<if test="password != null and password !='' ">
			and EMP.PASSWORD = #{password}
		</if>
	</select>
	
	<!--更新员工信息 -->
	<update id="updateEmployee" parameterType="employee">
		UPDATE
		    self_employee
		SET
			OPTER = #{opter}
		    , OPTDATE = sysdate()
		    <if test="empid != null and empid !='' ">
				, EMPID =  #{empid}   
			</if>
		    <if test="empcode != null and empcode !='' ">
				, EMPCODE =       #{empcode}      
			</if>     
			<if test="loginname != null and loginname !='' ">
				, LOGINNAME =     #{loginname}      
			</if> 
			<if test="empname != null and empname !='' ">
				, EMPNAME =       #{empname}  
			</if>  
			<if test=" sex != null and sex !='' ">
				, SEX =           #{sex}
			</if>  
			<if test=" status != null and status !='' ">
				, STATUS =        #{status}  
			</if>
			<if test=" type != null and type !='' ">
				, TYPE =          #{type}
			</if>
			<if test=" phone != null and phone !='' ">
				, PHONE =         #{phone}
			</if>
			<if test=" homeaddress != null and homeaddress !='' ">
				, HOMEADDRESS =   #{homeaddress}
			</if>
			<if test=" wechatid != null and wechatid !='' ">
				, WECHATID =      #{wechatid} 
			</if>
			<if test=" openid != null and openid !='' ">
				, OPENID =        #{openid}
			</if>
			<if test=" headimgurl != null and  headimgurl !='' ">
				, HEADIMGURL =    #{headimgurl} 
			</if>
			<if test=" contactname != null and  contactname !='' ">
				, CONTACTNAME =   #{contactname} 
			</if>
			<if test=" contactphone != null and contactphone  !='' ">
				, CONTACTPHONE =  #{contactphone} 
			</if>
			<if test=" loginnum != null and loginnum !='' ">
				, LOGINNUM =      #{loginnum}
			</if>
			<if test=" lastlogindate != null and lastlogindate !='' ">
				, LASTLOGINDATE = #{lastlogindate} 
			</if>
			<if test=" sid != null and sid !='' ">
				, SID =           #{sid} 
			</if>
			<if test=" bid != null and bid !='' ">
				, BID =           #{bid}  
			</if>
			<if test=" deleted != null and deleted !='' ">
				, DELETED =       #{deleted} 
			</if>
		WHERE
		    EMPID = #{empid}
		
	</update>
	
	<!--获取商户最大员工编号 -->
	<select id="getMaxEmpCode"  parameterType="java.lang.String" resultType="java.lang.String">
		select max(emp.EMPCODE) from self_employee emp where emp.DELETED = 0 and emp.BID = #{bid}
	</select>
	
	<!--修改员工密码-->
	<update id="updatePassword" parameterType="employee">
		UPDATE
		    self_employee
		SET
			OPTER = #{opter}
		    , OPTDATE = sysdate()
		    <if test="password != null and password !='' ">
				, PASSWORD =  #{password}   
			</if> 
		WHERE
		    EMPID = #{empid}
	</update>
</mapper>

