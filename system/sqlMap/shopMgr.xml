<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.selforder.shop" >
	<cache eviction="LRU" flushInterval="1000" size="1024" readOnly="false" />
	<sql id="limit">
		<choose>
		<when test="pageStart != null and pageSize != null and pageStart != '' and pageSize != '' ">
			limit ${pageStart},${pageSize}
		</when>
		<otherwise>
			limit 0,20
		</otherwise>
		</choose>
	</sql>
	<!--新增商户信息 -->
	<insert id="insertShop">
		INSERT
			INTO
			    self_business_shop
			    (
			        SID,
			        SNAME,
			        SCODE,
			        BID,
			        LINKMAN,
			        PHONE,
			        ADDRESS,
			        LONGITUDE,
			        LATITUDE,
			        ISOUTSELL,
			        ISARRAY,
			        SHOPIMG,
			        CRTER,
			        CRTDATE,
			        OPTER,
			        OPTDATE,
			        DELETED
			    )
			    VALUES
			    (
			        replace(uuid(),'-',''),
			        #{sname},
			        #{scode},
			        #{bid},
			        #{linkman},
			        #{phone},
			        #{address},
			        #{longitude},
			        #{latitude},
			        #{isoutsell},
			        #{isarray},
			        #{shopimg},
			        #{crter},
			        sysdate(),
			        #{opter},
			        sysdate(),
			        0
			    )
	</insert>
	
	<!--获取商户列表 -->
	<select id="getShopList"  parameterType="shop" resultType="shop">
		SELECT
		    shop.SID,
		    shop.SNAME,
		    shop.SCODE,
		    shop.BID,
		    business.BNAME,
		    shop.LINKMAN,
		    shop.PHONE,
		    shop.ADDRESS,
		    shop.LONGITUDE,
		    shop.LATITUDE,
		    shop.ISOUTSELL,
		    shop.ISARRAY,
		    shop.SHOPIMG,
		    shop.CRTER,
		    shop.CRTDATE,
		    shop.OPTER,
		    shop.OPTDATE,
		    shop.DELETED
		FROM
		    self_business_shop shop
		left join SELF_BUSINESS business on business.BID = shop.BID
		where business.DELETED = 0
		and shop.DELETED = 0
		<if test="sname != null and sname !='' ">
			and shop.SNAME like CONCAT('%',#{sname},'%')
		</if>    
		<if test="scode != null and scode !='' ">
			and shop.SCODE like CONCAT('%',#{scode},'%')
		</if>
		<if test="linkman != null and linkman !='' ">
			and shop.LINKMAN like CONCAT('%',#{linkman},'%')
		</if>
	</select>
	<!--查询商户列表统计数  用于列表分页 -->
	<select id="getShopCount" parameterType="shop" resultType="int">
		SELECT
		    count(1) 
		FROM
		    self_business_shop shop
		left join SELF_BUSINESS business on business.BID = shop.BID
		where business.DELETED = 0
		and shop.DELETED = 0   
		<if test="sname != null and sname !='' ">
			and shop.SNAME like CONCAT('%',#{sname},'%')
		</if>    
		<if test="scode != null and scode !='' ">
			and shop.SCODE like CONCAT('%',#{scode},'%')
		</if>
		<if test="linkman != null and linkman !='' ">
			and shop.LINKMAN like CONCAT('%',#{linkman},'%')
		</if>
	</select>
	
	<!--获取商户详情 -->
	<select id="getShopInfo"  parameterType="shop" resultType="shop">
		SELECT
		    shop.SID,
		    shop.SNAME,
		    shop.SCODE,
		    shop.BID,
		    business.BNAME,
		    shop.LINKMAN,
		    shop.PHONE,
		    shop.ADDRESS,
		    shop.LONGITUDE,
		    shop.LATITUDE,
		    shop.ISOUTSELL,
		    shop.ISARRAY,
		    shop.SHOPIMG,
		    shop.CRTER,
		    shop.CRTDATE,
		    shop.OPTER,
		    shop.OPTDATE,
		    shop.DELETED
		FROM
		    self_business_shop shop
		left join SELF_BUSINESS business on business.BID = shop.BID
		where business.DELETED = 0
		and shop.DELETED = 0
		<if test="sid != null and sid !='' ">
			and shop.SID = #{sid}
		</if>  
		<if test="sname != null and sname !='' ">
			and shop.SNAME like CONCAT('%',#{sname},'%')
		</if>    
		<if test="scode != null and scode !='' ">
			and shop.SCODE like CONCAT('%',#{scode},'%')
		</if>
		<if test="linkman != null and linkman !='' ">
			and shop.LINKMAN like CONCAT('%',#{linkman},'%')
		</if>
	</select>
	
	<!--更新商户信息 -->
	<update id="updateShop" parameterType="shop">
		UPDATE
		    self_business_shop
		SET
			OPTER = #{opter}
		    , OPTDATE = sysdate()
		    <if test="sname != null and sname !='' ">
				, SNAME = #{sname}
			</if>
			<if test="scode != null and scode !='' ">
				, SCODE = #{scode}
			</if>
			<if test="linkman != null and linkman !='' ">
				, LINKMAN = #{linkman}
			</if>
			<if test="phone != null and phone !='' ">
				, PHONE = #{phone}
			</if>
			<if test="address != null and address !='' ">
				, ADDRESS = #{address}
			</if>
			<if test="longitude != null and longitude !='' ">
				, LONGITUDE = #{longitude}
			</if>
			<if test="latitude != null and latitude !='' ">
				, LATITUDE = #{latitude}
			</if>
			<if test="isoutsell != null and isoutsell !='' ">
				, ISOUTSELL = #{isoutsell}
			</if>
			<if test="isarray != null and isarray !='' ">
				, ISARRAY = #{isarray}
			</if>
			<if test="shopimg != null and shopimg !='' ">
				, SHOPIMG = #{shopimg}
			</if>
		WHERE
		    SID = #{sid}
	</update>
</mapper>

